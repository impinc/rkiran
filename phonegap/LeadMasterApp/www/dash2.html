<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, target-densitydpi=medium-dpi" />
		<link rel="stylesheet" href="css/styleleft.css" type="text/css" media="all" />
		<script type="text/javascript" src="js/jquery-1.8.2.min.js"></script>
		<script type="text/javascript"  charset="utf-8" src="cordova.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/phonegap-1.0.0.js"></script>
		<script type="text/javascript" charset="utf-8" src="js/encryption.js"></script>

		<link rel="stylesheet" media="all and (orientation:portrait)" href="css/dashbo2.css">
		<link rel="stylesheet" media="all and (orientation:landscape)" href="css/dashbo2_hor.css">

		<script type ="text/javascript">
		

			function buttonClicked(buttonType) {

/** Condition for Add New button clicked **/

				if (buttonType == 'addNew') {

					directToAddLead();
		//	window.JBRIDGE.test();
				}


/** Condition works for Logout button clicked **/


				if (buttonType == 'logout') {
					
					localStorage.removeItem("dashboard");
					window.localStorage.setItem("dashboard","");
					window.location = "index.html";
					
					var url = url_main + "/mobile_auth.asp?key=" + encrptVal + "&topage=index_logoff.asp";
		
					 var ref=window.open(url, '_blank', 'location=no,closebuttoncaption=Main');

					
					localStorage.removeItem("Events");
					localStorage.removeItem("Accounts");
					localStorage.removeItem("My Searches");
					localStorage.removeItem("Shortcuts");
					localStorage.removeItem("Recent Items");

					ref.addEventListener("loadstop", function(event) {
						ref.close();
					});
					ref.removeEventListener("loadstop", callback);
					ref.close();
					
					
					window.JBRIDGE.no_alert();
					window.JBRIDGE.stopService();
					
				

				}
				
/** Condition works for ChangePassword button clicked **/				
				if (buttonType == 'changePassword') {

					directToChangePass();

				}

			}

			// window.plugins.orientationLock.lock("landscape")
		</script>

	</head>

	<body onload="getAllCredentialForDashboard()">

		<div class="headerdash">
			<header>
				<div id="headerImage"> </div>
			</header>
		</div>
		<div>
			<div  class="upper"   style="overflow:auto;  height: 100%;" >
				
				<div id="upperId">

				<table cellpadding="0" cellspacing="0"  border='0' align="center" style="border-collapse: collapse;">
					<tr align="center">
						<td><a onclick="directToCallback()"><div id="callback"> </div></a></td>
						<td id="icon_contacts" style="display:block;"><a onclick="directToAccount(2)"><div id="contacts"> </div></a></td>
						<td id="icon_accounts" style="display:block;"><a onclick="directToAccount(1)"><div id="accounts"> </div></a></td>
						<!--<td><a onclick="directToDashBoard()"><div id="new_lead"> </div></a></td>-->

					</tr>
					<tr valign="top"  align="texttop" class="label_tr" >
						<td align="center" class="label_fixed_width"><div id="label_callback" style="word-wrap: break-word;"> Callback Task</div></td>
						<td align="center" class="label_fixed_width" style="display:block;"><div id="label_contacts" style="word-wrap: break-word;">Contacts</div></td>
						<td align="center" class="label_fixed_width" style="display:block;"><div id="label_account" style="word-wrap: break-word;">Accounts</div></td>
					</tr>
					

					<tr align="center">

						<td><a onclick="directToMyShortcut()" id="message" ><div id="new_lead"> </div></a></td>
						<td><a onclick="directToRecentItems()"><div id="recent_items"> </div></a></td>
						<td><a onclick="directToDashBoard()"><div id="dashboard"> </div></a></td>

						<!--<td><a onclick="directToMySearches()"><div id="my_searches"> </div></a></td>-->
						<td align="center" style="display:none;"> </td>

					</tr>
					<tr valign="top"  align="texttop" class="label_tr">
						<td align="center" id="label_my_shortcut"  class="label_fixed_width" >My Shortcuts</td>
						<td align="center" id="label_recent_item"  class="label_fixed_width" >Recent Items</td>
						<td align="center" class="label_fixed_width" style="display:block;" ><div style="word-wrap: break-word;">Dashboard</div></td>
						<!--<td align="center" id="label_my_searches"  class="label_fixed_width" style="display:none;" >My Searches</td> -->
					</tr>

				</table>
				</div>
				<div id="buttonform">
					<div>
						<input type="submit" class="button" id="label_Calendar" onclick="getCalendar()" value="Calendar" style="width: 90%;background-color:#003366;"; />
						<input type="submit" class="button" id="addNew" onclick="buttonClicked('addNew')" value="Add New" style="width: 90%;background-color:#003366"/>
						<input type="submit" class="button" id="opportunity" onclick="directToOpportunity()" value="Opportunities" style="width: 90%;background-color:#003366"/>
						<input type="submit" class="button" id="case" onclick="directTocase()" value="Cases" style="width: 90%;background-color:#003366"/>
						<input type="submit" class="button" id="search" onclick="directSearch()" value="Search" style="width: 90%; background-color:#003366"/>
						<input type="submit" class="button" id="library" onclick="directToLibrary()" value="Library" style="width: 90%;background-color:#003366"/>
						<input type="submit" class="button" id="logout" onclick="buttonClicked('logout')" value="Logout" style="width: 90%;background-color:#003366"/>
						<!--<input type="submit" class="button" id="changePassword" onclick="buttonClicked('changePassword')" value="Change Password" style="width: 90%;background-color:#003366"/>-->
						<!--	<input type="submit" class="button" id="admin" onclick="directToAdmin()" value="Admin" style="width: 90%;background-color:#003366"/> -->
					</div>
					<div id="dvbtn6" style="border-top: 0px">
					</div>
					<script>
						var wgSize = window.localStorage.getItem("wgSize1");
						if (wgSize == 1) {
							document.getElementById("dvbtn6").style.display = "none";
						}
					</script>
				</div>
			</div>
		</div>
		<div  style="bottom: 0px;position: fixed;  background-color: #F3F3F3;min-width: 100%;margin-left: 0px;right: 0px;" class="footer1" id="footerId">
			<table style="text-align: center;width:100%;vertical-align: middle" cellspacing="0" border="0">
				<tr style="width: 100%;" >
					<td  align= "left" style="width:15%;padding-left: 8px;" onclick="directToCallback()"><div id="callback1" style="margin-left: 2px;"> </div></td>
					<td id="ft_accounts" align= "left" style="width:15%;padding-left: 8px;display:block;"  onclick="directToAccount(1)"><div id="accounts1" style="margin-left: -6px"> </div></td>
					<td id="ft_contacts" align= "left" style="width:15%;padding-left: 8px;display:none;"  onclick="directToAccount(2)"><div id="contacts1" style="margin-left: -6px"> </div></td>
					<td  align= "left" style="width:15%;padding-left: 8px;" onclick="directToDashBoard()"><div id="dashboard1" style="margin-left: -6px"> </div></td>
					<td  align= "left" style="width:15%;padding-left: 8px;" onclick="directToRecentItems()"><div id="recent_items1" style="margin-right: -4px"> </div></td>
					<td  align= "left" style="width:15%;padding-left: 8px;" onclick="directToMySearches()"><div id="my_searches1" style="margin-left: -6px"> </div></td>
					<td  align= "left" style="width:15%;padding-left: 8px;" onclick="directToAdmin()"><div id="new_lead1" style="margin-left: -6px"> </div></td>
				</tr>
			</table>
		</div>
	</body>
</html>

<script type="text/javascript">
	var url_main,encrptVal,dashOrin = true;
	
	
	function directToChangePass() {

		window.location = "changePassword.html";
	}

	function directToAccount(sendto) {

	
	//	navigator.notification.activityStart("Please wait", "loading.....");
		if(sendto == 1){
			window.location = "account.html";
		}
		if(sendto == 2){
			window.location = "contacts.html";
		}
		
	}

	function directToMyShortcut() {
	
	//	navigator.notification.activityStart("Please wait", "loading.....");
		window.location = "myShortcut.html";
//alert(window.innerWidth);
		

	}
	function directToAdmin() {
	//	navigator.notification.activityStart("Please wait", "loading.....");
		window.location = "admin.html";
	}

	function directToCallback() {
		// var encrptVal = getEncrption();
		// var url = "http://qa2.leadmaster.com/mobile_auth.asp?key=" + encrptVal + "&topage=mobile_rptEvent.asp&frompage=welcome&thisOpt=2";
		//
		// var ref=window.open(url, '_blank', 'closebuttoncaption=Main');
	//	navigator.notification.activityStart("Please wait", "loading....");

		window.location = "callBackEvent.html";

	}

	function directToMySearches() {
		// var encrptVal = getEncrption();
		// var url = "http://qa2.leadmaster.com/mobile_auth.asp?key=" + encrptVal + "&topage=mobile_MySearches.asp";
		//
		// window.open(url, '_blank', 'closebuttoncaption=Main');
	//	navigator.notification.activityStart("Please wait", "loading....");

		window.location = "mySearches.html";
	}

	function directToDashBoard() {

		dashOrin = false;
		var screenwidth= window.innerWidth
	//	alert(screenwidth);
		var url = url_main + "/mobile_auth.asp?key=" + encrptVal + "&topage=mobile_dashboard.asp&screenwidth="+  screenwidth+"";
		
				//alert(url);

		
	//	console.log("URL:" + url);

		var ref = window.open(url, '_blank', 'location=no,closebuttoncaption=Main');
		
		ref.addEventListener('exit', function() {dashOrin = true;  });


	}

	function directToRecentItems() {
		
	//	navigator.notification.activityStart("Please wait", "loading....");

		window.location = "recentItems.html";

	}

	function directToLibrary() {
//	navigator.notification.activityStart("Please wait", "loading.....");
		window.location = "library.html";
		
	}

/* Set Custom labels and get required credential onload of the page  */
	function getAllCredentialForDashboard() {
		
		//alert(123);
		encrptVal = getEncrption();
		url_main = window.localStorage.getItem("changed_url");
		wsURL=window.localStorage.getItem("wsURL");	
		

		var checkLabelExist = window.localStorage.getItem("Banner - Accounts");
		if (checkLabelExist == null || checkLabelExist == "") {
		//alert(checkLabelExist);
			getLabel();
			window.localStorage.setItem("dashboard", "logged in");
		}

		var username = window.localStorage.getItem("username");
		var password = window.localStorage.getItem("password");
		var companyId = window.localStorage.getItem("company_id");
		var databaseId = window.localStorage.getItem("database_id");
		
		
		
		var callbackName = window.localStorage.getItem("Events");
		
		if(callbackName!="" && callbackName!=null){
		document.getElementById("label_callback").innerHTML = callbackName;
		}
		

		var accountName = window.localStorage.getItem("Banner - Accounts");
		if(accountName!="" && accountName!=null){
		document.getElementById("label_account").innerHTML = accountName;
		}
		var mySearchesName = window.localStorage.getItem("My Searches");
		if(mySearchesName!="" && mySearchesName!=null){
		document.getElementById("label_my_searches").innerHTML = mySearchesName;
		}
		var myShortcutsName = window.localStorage.getItem("Shortcuts");
		if(myShortcutsName!="" && myShortcutsName!=null){
		document.getElementById("label_my_shortcut").innerHTML = myShortcutsName;
		}
		var recentItemsName = window.localStorage.getItem("Recent Items");
		if(recentItemsName!="" && recentItemsName!=null){
		document.getElementById("label_recent_item").innerHTML = recentItemsName;
		}
		if(window.innerHeight < window.innerWidth){
   			document.getElementById("upperId").style.display = "none";
		}

		var lblCalendar = window.localStorage.getItem("Events");
		if(lblCalendar!="" && lblCalendar!=null){
			document.getElementById("label_Calendar").value = lblCalendar;
		}

		url_main = window.localStorage.getItem("changed_url");

		if (url_main == null || url_main == "") {

			window.localStorage.setItem("changed_url", "http://app.leadmastercrm.com");

		}

		var AccountLink = window.localStorage.getItem("AccountLink");
		if (AccountLink == "false"){
			document.getElementById("icon_accounts").style.display = "none";
			document.getElementById("label_account").style.display = "none";
			document.getElementById("ft_accounts").style.display = "none";

			document.getElementById("icon_contacts").style.display = "block";
			document.getElementById("label_contacts").style.display = "block";
			document.getElementById("ft_contacts").style.display = "block";
		}
		
		window.JBRIDGE.callService(username, password, companyId, databaseId);
		window.JBRIDGE.yes_alert();

	}

	
	document.addEventListener("deviceready", function() {
		navigator.notification.activityStop();

	});

	document.addEventListener("deviceready", onDeviceReady, false);

	function onDeviceReady() {
		
		
		 dashOrin = true;
		document.addEventListener("backbutton", onBackKeyDown, false);
		//Listen to the User clicking on the back button

		var initialScreenSize = window.innerHeight;
		window.addEventListener("resize", function() {
			
		
			
			if (window.innerHeight < initialScreenSize) {
				$("[data-role=footer]").hide();
			} else {
				$("[data-role=footer]").show();
			}
			
			
		});

		document.addEventListener("menubutton", onMenuKeyDown, false);
	}


window.addEventListener("orientationchange", function() {
	// Announce the new orientation number
	// alert(window.orientation);
	
	if(dashOrin){
	if(window.innerHeight > window.innerWidth){
    			document.getElementById("upperId").style.display = "none";
				}
				
				else{
					
					document.getElementById("upperId").style.display = "block";
				}
			}
}, false);
	function onBackKeyDown(e) {
		e.preventDefault();
		navigator.app.exitApp();
		// navigator.notification.confirm("Are you sure you want to exit ?", onConfirm, "Confirmation", "Yes,No");
		// Prompt the user with the choice

	}

	function onConfirm(button) {
		if (button == 2) {
			//If User selected No, then we just do nothing
			return;
		} else {		
			navigator.app.exitApp();
			// Otherwise we quit the app.

		}
	}

	function changeWG() {
	//	navigator.notification.activityStart("Please wait", "loading.....");

		var wgSize1 = window.localStorage.getItem("wgSize1");
		if (wgSize1 > 1) {

			window.location = "db.html";
			window.JBRIDGE.no_alert();
			window.JBRIDGE.stopService();

		} else {
			alert('You have single WorkGroup');
		}

	}

	function directToAddLead() {

	//	navigator.notification.activityStart("Please wait", "loading.....");
		window.location = "addNew.html";
	}
	function directSearch() {
	//	navigator.notification.activityStart("Please wait", "loading.....");
		
		window.location = "search.html";
	}
	function directToOpportunity() {
	//alert("test");
	//	navigator.notification.activityStart("Please wait", "loading.....");

		window.location = "opportunity.html";
	}

	function directTocase() {


	//	navigator.notification.activityStart("Please wait", "loading.....");

		window.location = "case.html";
}
	

	function getLabel() {

		jQuery.ajaxSetup({
			async : false
		});

		// var label=["Banner - Accounts","Company","Contact","Lead Status",,"Campaign","Event","Shortcuts",,"My Searches","Recent Items"];
		var labelNames = "Banner - Accounts^Company^Contact^Lead Status^Entered^Campaign^Events^Event Name^Event^Shortcuts^My Searches^Recent Items^Acct Mgr^Opportunity^Case^Sales Rep Comments/Notes^Record^Opportunity Name^Phone^Cases";
		var companyId = window.localStorage.getItem("company_id");
		var logonID = window.localStorage.getItem("logonID");

		var productServiceUrl = wsURL+'GetCustomLabel';
		//alert(productServiceUrl);
	//	console.log("purl=" +productServiceUrl);

		// Preferably write this out from server side
		var soapMessage = '<?xml version="1.0" encoding="utf-8"?><soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"><soap:Body><GetCustomLabel xmlns="LMServiceNamespace"><LogonID>' + logonID + '</LogonID><CompanyID>' + companyId + '</CompanyID><LabelName>' + labelNames + '</LabelName></GetCustomLabel></soap:Body></soap:Envelope>';

		$.ajax({
			url : productServiceUrl,
			type : "POST",
			dataType : "xml",
			data : soapMessage,
			complete : gettingCount,
			contentType : "text/xml; charset=\"utf-8\""
		});

		jQuery.ajaxSetup({
			async : true
		});

		function gettingCount(xmlHttpRequest, status) {

			var length = xmlHttpRequest.responseXML.length;
			if (!(status == 'success')) {

				alert('An error has occurred.  Try again or check your Internet connection.');
				navigator.notification.activityStop();
				return false;
			}
			$(xmlHttpRequest.responseXML).find('TypeKeyValue').each(function() {
				var key = $(this).find('Key').text();
				var value = $(this).find('Value').text();

				window.localStorage.setItem(key, value);

			});

		}

	}
	
	function toLibrary(){
	
	var url = url_main + "/mobile_auth.asp?key=" + encrptVal + "&topage=LibraryV2/mobile_FileList.asp";
	//	console.log("URL:" + url);

		window.open(url, '_blank', 'location=no,closebuttoncaption=Main');
	}
	

	function getCalendar() {

		var url = url_main + "/mobile_auth.asp?key=" + encrptVal + "&topage=mobile_calWeek.asp";
	//	console.log("URLLL:" + url);
		window.open(url, '_blank', 'location=no,closebuttoncaption=Main');

	}
</script>
